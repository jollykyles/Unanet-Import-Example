<?xml version='1.0' encoding='utf-8'?>
<project name="email-macro" basedir=".">
   <macrodef name="send-mail">
      <attribute name="subject"/>
      <text name="body"/>
      <element name="attachments"/>
      <sequential>
         <if><and>
              <isset property="email.host"/>
              <isset property="email.to"/>
              <isset property="email.from"/>
            </and>
         <then>
            <if><isset property="email.user"/>
            <then>
               <mail mailhost="${email.host}"
                         from="${email.from}"
                       tolist="${email.to}"
                          ssl="${email.ssl}"
               	   mailport="${email.port}"
             	enableStartTLS="${email.enableStartTLS}"
                         user="${email.user}"
                     password="${email.password}"
                      subject="@{subject}"
              messagemimetype="text/html">
                  <message>
                     @{body}
                  </message>
                  <attachments/>
               </mail>
            </then>
            <else>
               <mail mailhost="${email.host}"
                         from="${email.from}"
                       tolist="${email.to}"
                          ssl="${email.ssl}"
                     mailport="${email.port}"
               enableStartTLS="${email.enableStartTLS}"
                      subject="@{subject}"
              messagemimetype="text/html">
                  <message>
                     @{body}
                  </message>
                  <attachments/>
               </mail>
            </else>
            </if>
         </then>
         <else>
            <echo>Email properties are not set, so no email will be sent.</echo>
         </else>
         </if>
      </sequential>
   </macrodef>
</project>